(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,a){e.exports=a(186)},109:function(e,t,a){},112:function(e,t,a){},120:function(e,t){},121:function(e,t){},122:function(e,t){},123:function(e,t){},124:function(e,t){},125:function(e,t){},126:function(e,t,a){},184:function(e,t,a){},186:function(e,t,a){"use strict";a.r(t);var n=a(3),o=a(4),s=a(6),r=a(7),i=a(1),c=a.n(i),l=a(38),d=a.n(l),u=a(36),p=(a(108),a(109),a(12)),m=a(190),h=a(193),f=a(100),v=a(194),w=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){return this.props.show?c.a.createElement(v.a,{variant:this.props.variant||"danger",onClose:this.props.onClose,dismissible:!0},this.props.title&&c.a.createElement("h5",null,c.a.createElement("strong",null,this.props.title)),c.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.message}})):null}}]),a}(i.Component),g=(a(112),function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){return c.a.createElement("div",{className:"About container"},c.a.createElement("h1",null,"About"),c.a.createElement("p",null,"This is a TensorFlow.js web application where users can classify images selected locally or taken with their device's camera. The app uses TensorFlow.js and a pre-trained model converted to the TensorFlow.js format to provide the inference capabilities. This model is saved locally in the browser using IndexedDB. A service worker is also used to provide offline capabilities."))}}]),a}(i.Component)),b=a(11),E=a.n(b),y=a(15),x=a(189),O=a(188),C=a(96),A=a(195),k=a(191),j=a(192),S=a(196),U=a(62),N=a(101),I=a(87),L=a.n(I),M=a(16),T=a(102),R=["isLoading","text","loadingText","className","disabled"],D=function(e){var t=e.isLoading,a=e.text,n=e.loadingText,o=e.className,s=void 0===o?"":o,r=e.disabled,i=void 0!==r&&r,l=Object(T.a)(e,R);return c.a.createElement(O.a,Object.assign({className:"LoadButton ".concat(s),disabled:i||t},l),t&&c.a.createElement(x.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," ",t?n:a)},P={0:"AADHAAR",1:"DRIVING LICENSE",2:"PAN",3:"PASSPORT",4:"VOTER ID"},_={API_ENDPOINT:"http://localhost:5000/api"},W=(a(126),a(127),a(185).Image);function B(e,t,a){var n=e.cols,o=e.rows,s=parseInt(n*Math.min(t/n,a/o)),r=parseInt(o*Math.min(t/n,a/o)),i=new window.cv.Mat,c=new window.cv.Size(s,r);window.cv.resize(e,i,c,0,0,window.cv.INTER_CUBIC);for(var l=window.cv.Mat.zeros(a,t,window.cv.CV_8U),d=~~((t-s)/2),u=~~((a-r)/2),p=0;p<r;p++)for(var m=0;m<s;m++)l.ucharPtr(u+p,d+m)[0]=i.ucharPtr(p,m)[0];return l}function F(e,t){return G.apply(this,arguments)}function G(){return(G=Object(y.a)(E.a.mark(function e(t,a){var n,o;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,M.g(t.data).div(M.e(255)).array();case 3:return e.t1=e.sent,e.t0.log.call(e.t0,e.t1),e.next=7,a.predict([M.g(t.data).div(M.e(255)).reshape([1,80,80,1])]);case 7:return n=e.sent,e.next=10,n.array();case 10:return o=e.sent,e.abrupt("return",M.f(o[0]).array());case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function z(e){console.log(e),window.cv.cvtColor(e,e,window.cv.COLOR_RGBA2GRAY),console.log(e);var t=new window.cv.Mat;console.log(t);var a=window.cv.Mat.ones(9,9,window.cv.CV_8U);return console.log(a),window.cv.morphologyEx(e,t,window.cv.MORPH_BLACKHAT,a),window.cv.cvtColor(t,t,window.cv.COLOR_GRAY2RGBA),console.log(t),t}function K(e){return Y.apply(this,arguments)}function Y(){return(Y=Object(y.a)(E.a.mark(function e(t){var a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.load(t);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var H=function(){var e=Object(y.a)(E.a.mark(function e(t,a){var n,o,s,r,i;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(t);case 2:return n=e.sent,e.next=5,new window.cv.matFromImageData(n);case 5:return o=e.sent,console.log(o.rows),s=z(o),console.log(s),window.cv.cvtColor(s,s,window.cv.COLOR_RGBA2GRAY),console.log(s),r=B(s,80,80),console.log(r),window.cv.cvtColor(r,r,window.cv.COLOR_GRAY2RGBA),window.cv.cvtColor(r,r,window.cv.COLOR_RGBA2GRAY),console.log(r),e.next=18,F(r,a);case 18:return i=e.sent,e.abrupt("return",i);case 20:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),V="/kyc_ocr/model/model.json",J=224,$=224,q=5,Q="web-model",X=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var o;return Object(n.a)(this,a),(o=t.call(this,e)).initWebcam=Object(y.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.b.webcam(o.refs.webcam,{resizeWidth:$,resizeHeight:$,facingMode:"environment"});case 3:o.webcam=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),o.refs.noWebcam.style.display="block";case 9:case"end":return e.stop()}},e,null,[[0,6]])})),o.startWebcam=Object(y.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.webcam&&o.webcam.start();case 1:case"end":return e.stop()}},e)})),o.stopWebcam=Object(y.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.webcam&&o.webcam.stop();case 1:case"end":return e.stop()}},e)})),o.getModelInfo=Object(y.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(_.API_ENDPOINT,"/model_info"),{method:"GET"}).then(function(){var e=Object(y.a)(E.a.mark(function e(t){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json().then(function(e){o.modelLastUpdated=e.last_updated}).catch(function(e){console.log("Unable to get parse model info.")});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log("Unable to get model info")});case 2:case"end":return e.stop()}},e)})),o.updateModel=Object(y.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Updating the model: "+Q),o.setState({isDownloadingModel:!0}),e.next=4,M.d(V);case 4:return o.model=e.sent,e.next=7,o.model.save("indexeddb://"+Q);case 7:o.setState({isDownloadingModel:!1,modelUpdateAvailable:!1,showModelUpdateAlert:!1,showModelUpdateSuccess:!0});case 8:case"end":return e.stop()}},e)})),o.classifyLocalImage=Object(y.a)(E.a.mark(function e(){var t,a,n,s,r,i,c,l,d,u,p;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.setState({isClassifying:!0}),t=o.refs.cropper.getCroppedCanvas(),console.log(t),console.log(M.a.fromPixels(t)),a=M.h(function(){return M.a.fromPixels(t).toFloat()}),console.log(t.toDataURL()),e.next=8,new Uint8ClampedArray(a.array());case 8:return n=e.sent,console.log(n),s=t.toDataURL(),r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imagebuf:s,height:a.shape[0],width:a.shape[1],channels:a.shape[2]})},console.log(r),e.next=15,H(s,o.model);case 15:return i=e.sent,console.log(i),e.next=19,o.getTopKClasses(i,q);case 19:c=e.sent,o.setState({predictions:c,isClassifying:!1,photoSettingsOpen:!o.state.photoSettingsOpen}),l=o.refs.canvas.getContext("2d"),d=$/t.width,u=$/t.height,p=Math.min(d,u),l.clearRect(0,0,$,$),l.drawImage(t,0,0,t.width*p,t.height*p),a.dispose();case 28:case"end":return e.stop()}},e)})),o.classifyWebcamImage=Object(y.a)(E.a.mark(function e(){var t,a,n,s,r,i,c;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.setState({isClassifying:!0}),e.next=3,o.webcam.capture();case 3:return t=e.sent,console.log(t.print()),a=M.c.resizeBilinear(t,[J,J]),e.next=8,o.processImage(a);case 8:return n=e.sent,s=o.model.predict(n),e.next=12,s.data();case 12:return r=e.sent,e.next=15,o.getTopKClasses(r,q);case 15:return i=e.sent,o.setState({predictions:i,isClassifying:!1,photoSettingsOpen:!o.state.photoSettingsOpen}),c=M.h(function(){return t.toFloat().div(255)}),e.next=20,M.a.toPixels(c,o.refs.canvas);case 20:t.dispose(),s.dispose(),c.dispose(),n.dispose();case 24:case"end":return e.stop()}},e)})),o.processImage=function(){var e=Object(y.a)(E.a.mark(function e(t){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t.expandDims(0).toFloat()),e.abrupt("return",M.h(function(){return t.expandDims(0).toFloat().div(127).sub(1)}));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),o.getTopKClasses=function(){var e=Object(y.a)(E.a.mark(function e(t,a){var n,o,s,r,i,c,l;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],o=0;o<t.length;o++)n.push({value:t[o],index:o});for(n.sort(function(e,t){return t.value-e.value}),s=new Float32Array(a),r=new Int32Array(a),i=0;i<a;i++)s[i]=n[i].value,r[i]=n[i].index;for(c=[],l=0;l<r.length;l++)c.push({className:P[r[l]],probability:(100*s[l]).toFixed(2)});return e.abrupt("return",c);case 9:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),o.handlePanelClick=function(e){o.setState({photoSettingsOpen:!o.state.photoSettingsOpen})},o.handleFileChange=function(e){e.target.files&&e.target.files.length>0&&o.setState({file:URL.createObjectURL(e.target.files[0]),filename:e.target.files[0].name})},o.handleTabSelect=function(e){switch(e){case"camera":o.startWebcam();break;case"localfile":o.setState({filename:null,file:null}),o.stopWebcam()}},o.webcam=null,o.model=null,o.modelLastUpdated=null,o.state={modelLoaded:!1,filename:"",isModelLoading:!1,isClassifying:!1,predictions:[],photoSettingsOpen:!0,modelUpdateAvailable:!1,showModelUpdateAlert:!1,showModelUpdateSuccess:!1,isDownloadingModel:!1},o}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=Object(y.a)(E.a.mark(function e(){var t,a,n;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("indexedDB"in window)){e.next=36;break}return e.prev=1,e.next=4,M.d("indexeddb://"+Q);case 4:return this.model=e.sent,e.prev=5,e.next=8,Object(N.a)("tensorflowjs",1);case 8:return t=e.sent,e.next=11,t.transaction("model_info_store").objectStore("model_info_store").get(Q);case 11:return a=e.sent,n=new Date(a.modelArtifactsInfo.dateSaved),e.next=15,this.getModelInfo();case 15:console.log(this.modelLastUpdated),!this.modelLastUpdated||n>=new Date(this.modelLastUpdated).getTime()?console.log("Using saved model"):this.setState({modelUpdateAvailable:!0,showModelUpdateAlert:!0}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(5),console.warn(e.t0),console.warn("Could not retrieve when model was saved.");case 23:e.next=34;break;case 25:return e.prev=25,e.t1=e.catch(1),console.log("Not found in IndexedDB. Loading and saving..."),console.log(e.t1),e.next=31,M.d(V);case 31:return this.model=e.sent,e.next=34,this.model.save("indexeddb://"+Q);case 34:e.next=40;break;case 36:return console.warn("IndexedDB not supported."),e.next=39,M.d(V);case 39:this.model=e.sent;case 40:this.setState({modelLoaded:!0}),this.initWebcam();case 42:case"end":return e.stop()}},e,this,[[1,25],[5,19]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(y.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.webcam&&this.webcam.stop();try{this.model.dispose()}catch(t){}case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:"Classify container"},!this.state.modelLoaded&&c.a.createElement(i.Fragment,null,c.a.createElement(x.a,{animation:"border",role:"status"},c.a.createElement("span",{className:"sr-only"},"Loading..."))," ",c.a.createElement("span",{className:"loading-model-text"},"Loading Model")),this.state.modelLoaded&&c.a.createElement(i.Fragment,null,c.a.createElement(O.a,{onClick:this.handlePanelClick,className:"classify-panel-header","aria-controls":"photo-selection-pane","aria-expanded":this.state.photoSettingsOpen},"Take or Select a Photo to Classify",c.a.createElement("span",{className:"panel-arrow"},this.state.photoSettingsOpen?c.a.createElement(U.b,null):c.a.createElement(U.c,null))),c.a.createElement(C.a,{in:this.state.photoSettingsOpen},c.a.createElement("div",{id:"photo-selection-pane"},this.state.modelUpdateAvailable&&this.state.showModelUpdateAlert&&c.a.createElement(m.a,null,c.a.createElement(v.a,{variant:"info",show:this.state.modelUpdateAvailable&&this.state.showModelUpdateAlert,onClose:function(){return e.setState({showModelUpdateAlert:!1})},dismissible:!0},"An update for the ",c.a.createElement("strong",null,this.state.modelType)," model is available.",c.a.createElement("div",{className:"d-flex justify-content-center pt-1"},!this.state.isDownloadingModel&&c.a.createElement(O.a,{onClick:this.updateModel,variant:"outline-info"},"Update"),this.state.isDownloadingModel&&c.a.createElement("div",null,c.a.createElement(x.a,{animation:"border",role:"status",size:"sm"},c.a.createElement("span",{className:"sr-only"},"Downloading..."))," ",c.a.createElement("strong",null,"Downloading..."))))),this.state.showModelUpdateSuccess&&c.a.createElement(m.a,null,c.a.createElement(v.a,{variant:"success",onClose:function(){return e.setState({showModelUpdateSuccess:!1})},dismissible:!0},"The ",c.a.createElement("strong",null,this.state.modelType)," model has been updated!")),c.a.createElement(A.a,{defaultActiveKey:"camera",id:"input-options",onSelect:this.handleTabSelect,className:"justify-content-center"},c.a.createElement(k.a,{eventKey:"camera",title:"Take Photo"},c.a.createElement("div",{id:"no-webcam",ref:"noWebcam"},c.a.createElement("span",{className:"camera-icon"},c.a.createElement(U.a,null)),"No camera found. ",c.a.createElement("br",null),"Please use a device with a camera, or upload an image instead."),c.a.createElement("div",{className:"webcam-box-outer"},c.a.createElement("div",{className:"webcam-box-inner"},c.a.createElement("video",{ref:"webcam",autoPlay:!0,playsInline:!0,muted:!0,id:"webcam",width:"448",height:"448"}))),c.a.createElement("div",{className:"button-container"},c.a.createElement(D,{variant:"primary",size:"lg",onClick:this.classifyWebcamImage,isLoading:this.state.isClassifying,text:"Classify",loadingText:"Classifying..."}))),c.a.createElement(k.a,{eventKey:"localfile",title:"Select Local File"},c.a.createElement(j.a.Group,{controlId:"file"},c.a.createElement(j.a.Label,null,"Select Image File"),c.a.createElement("br",null),c.a.createElement(j.a.Label,{className:"imagelabel"},this.state.filename?this.state.filename:"Browse..."),c.a.createElement(j.a.Control,{onChange:this.handleFileChange,type:"file",accept:"image/*",className:"imagefile"})),this.state.file&&c.a.createElement(i.Fragment,null,c.a.createElement("div",{id:"local-image"},c.a.createElement(L.a,{ref:"cropper",src:this.state.file,style:{height:"100%",width:"100%"},guides:!0,viewMode:2})),c.a.createElement("div",{className:"button-container"},c.a.createElement(D,{variant:"primary",size:"lg",disabled:!this.state.filename,onClick:this.classifyLocalImage,isLoading:this.state.isClassifying,text:"Classify",loadingText:"Classifying..."}))))))),this.state.predictions.length>0&&c.a.createElement("div",{className:"classification-results"},c.a.createElement("h3",null,"Predictions"),c.a.createElement("canvas",{ref:"canvas",width:$,height:$}),c.a.createElement("br",null),c.a.createElement(S.a,null,this.state.predictions.map(function(e){return c.a.createElement(S.a.Item,{key:e.className},c.a.createElement("strong",null,e.className)," ",e.probability,"%")})))))}}]),a}(i.Component),Z=function(e){var t=e.childProps;return c.a.createElement(p.c,null,c.a.createElement(p.a,{path:"/",exact:!0,component:X,props:t}),c.a.createElement(p.a,{path:"/about",exact:!0,component:g,props:t}))},ee=(a(184),a(99)),te=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var o;Object(n.a)(this,a),(o=t.call(this,e)).dismissUpdateAlert=function(e){o.setState({showUpdateAlert:!1})};return o.state={showUpdateAlert:!0,reloadMsg:"\n      New content is available.<br />\n      Please <a href='javascript:location.reload();'>reload</a>.<br />\n      <small>If reloading doesn't work, close all tabs/windows of this web application,\n      and then reopen the application.</small>\n    "},o}return Object(o.a)(a,[{key:"componentDidMount",value:function(){Object(ee.a)({onLoaded:function(){console.log(window.cv.getBuildInformation()),console.log("open cv loaded")},onFailed:function(){return console.log("open cv failed to load")},version:"4.5.1"})}},{key:"render",value:function(){return c.a.createElement("div",{className:"App"},c.a.createElement(m.a,null,c.a.createElement(h.a,{collapseOnSelect:!0,className:"app-nav-bar",variant:"dark",expand:"lg"},c.a.createElement(h.a.Brand,{href:"/"},"KYC"),c.a.createElement(h.a.Toggle,{"aria-controls":"basic-navbar-nav"}),c.a.createElement(h.a.Collapse,{id:"basic-navbar-nav"},c.a.createElement(f.a,{className:""},c.a.createElement(u.b,{className:"nav-link",to:"/"},"Classify"),c.a.createElement(u.b,{className:"nav-link",to:"/about"},"About")))),this.props.updateAvailable&&this.state.showUpdateAlert&&c.a.createElement("div",{style:{paddingTop:"10px"}},c.a.createElement(w,{title:"",variant:"info",message:this.state.reloadMsg,show:this.props.updateAvailable&&this.state.showUpdateAlert,onClose:this.dismissUpdateAlert}))),c.a.createElement(m.a,null,c.a.createElement(Z,null)))}}]),a}(i.Component),ae=Object(p.f)(te),ne=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function oe(e){if("serviceWorker"in navigator){if(new URL("/kyc_ocr",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/kyc_ocr","/service-worker.js");ne?(!function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):se(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):se(t,e)})}}function se(e,t){navigator.serviceWorker.register(e).then(function(e){function a(a){console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA2-PWA."),t&&t.onUpdate&&t.onUpdate(e,a)}e.waiting&&e.active&&a(e.waiting),e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?a(n):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var re=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(){var e;Object(n.a)(this,a);for(var o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).state={contentCached:!1,updateAvailable:!1},e.handleUpdate=function(t){var a=t.waiting;a&&a.postMessage({type:"SKIP_WAITING"}),e.setState({updateAvailable:!0})},e}return Object(o.a)(a,[{key:"componentDidMount",value:function(){oe({onUpdate:this.handleUpdate})}},{key:"render",value:function(){return c.a.createElement(u.a,null,c.a.createElement(ae,{updateAvailable:this.state.updateAvailable}))}}]),a}(i.Component);d.a.render(c.a.createElement(re,null),document.getElementById("root"))}},[[103,1,2]]]);
//# sourceMappingURL=main.aca209ba.chunk.js.map