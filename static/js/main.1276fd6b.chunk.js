(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{104:function(e,t,a){e.exports=a(187)},110:function(e,t,a){},113:function(e,t,a){},121:function(e,t){},122:function(e,t){},123:function(e,t){},124:function(e,t){},125:function(e,t){},126:function(e,t){},127:function(e,t,a){},185:function(e,t,a){},187:function(e,t,a){"use strict";a.r(t);var n=a(3),o=a(4),r=a(6),s=a(7),i=a(1),c=a.n(i),l=a(38),d=a.n(l),u=a(36),p=(a(109),a(110),a(12)),m=a(191),h=a(194),f=a(101),v=a(195),w=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){return this.props.show?c.a.createElement(v.a,{variant:this.props.variant||"danger",onClose:this.props.onClose,dismissible:!0},this.props.title&&c.a.createElement("h5",null,c.a.createElement("strong",null,this.props.title)),c.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.message}})):null}}]),a}(i.Component),g=(a(113),function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){return c.a.createElement("div",{className:"About container"},c.a.createElement("h1",null,"About"),c.a.createElement("p",null,"This is a TensorFlow.js web application where users can classify images selected locally or taken with their device's camera. The app uses TensorFlow.js and a pre-trained model converted to the TensorFlow.js format to provide the inference capabilities. This model is saved locally in the browser using IndexedDB. A service worker is also used to provide offline capabilities."))}}]),a}(i.Component)),b=a(11),y=a.n(b),E=a(15),x=a(190),O=a(189),C=a(97),k=a(196),A=a(192),j=a(193),S=a(197),U=a(62),N=a(102),M=a(88),L=a.n(M),T=a(16),I=a(103),R=["isLoading","text","loadingText","className","disabled"],_=function(e){var t=e.isLoading,a=e.text,n=e.loadingText,o=e.className,r=void 0===o?"":o,s=e.disabled,i=void 0!==s&&s,l=Object(I.a)(e,R);return c.a.createElement(O.a,Object.assign({className:"LoadButton ".concat(r),disabled:i||t},l),t&&c.a.createElement(x.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," ",t?n:a)},D={0:"AADHAAR",1:"DRIVING LICENSE",2:"NOT A DOCUMENT",3:"PAN",4:"PASSPORT",5:"VOTER ID"},P=(a(127),a(128),a(186).Image),W=200;function F(e,t,a){var n=e.cols,o=e.rows,r=parseInt(n*Math.min(t/n,a/o)),s=parseInt(o*Math.min(t/n,a/o)),i=new window.cv.Mat,c=new window.cv.Size(r,s);window.cv.resize(e,i,c,0,0,window.cv.INTER_CUBIC);for(var l=window.cv.Mat.zeros(a,t,window.cv.CV_8U),d=~~((t-r)/2),u=~~((a-s)/2),p=0;p<s;p++)for(var m=0;m<r;m++)l.ucharPtr(u+p,d+m)[0]=i.ucharPtr(p,m)[0];return l}function B(e,t){return G.apply(this,arguments)}function G(){return(G=Object(E.a)(y.a.mark(function e(t,a){var n,o;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,T.f(t.data).div(T.d(255)).array();case 3:return e.t1=e.sent,e.t0.log.call(e.t0,e.t1),e.next=7,a.predict([T.f(t.data).div(T.d(255)).reshape([1,W,W,1])]);case 7:return n=e.sent,e.next=10,n.array();case 10:return o=e.sent,e.abrupt("return",T.e(o[0]).array());case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function z(e){console.log(e),window.cv.cvtColor(e,e,window.cv.COLOR_RGBA2GRAY),console.log(e);var t=new window.cv.Mat;console.log(t);var a=window.cv.Mat.ones(25,7,window.cv.CV_8U);return console.log(a),window.cv.morphologyEx(e,t,window.cv.MORPH_BLACKHAT,a),window.cv.cvtColor(t,t,window.cv.COLOR_GRAY2RGBA),console.log(t),t}function K(e){return Y.apply(this,arguments)}function Y(){return(Y=Object(E.a)(y.a.mark(function e(t){var a;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.load(t);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var H=function(){var e=Object(E.a)(y.a.mark(function e(t,a){var n,o,r,s,i;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(t);case 2:return n=e.sent,e.next=5,new window.cv.matFromImageData(n);case 5:return o=e.sent,console.log(o.rows),r=z(o),console.log(r),window.cv.cvtColor(r,r,window.cv.COLOR_RGBA2GRAY),console.log(r),s=F(r,W,W),console.log(s),window.cv.cvtColor(s,s,window.cv.COLOR_GRAY2RGBA),window.cv.cvtColor(s,s,window.cv.COLOR_RGBA2GRAY),console.log(s),e.next=18,B(s,a);case 18:return i=e.sent,e.abrupt("return",i);case 20:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),V=a(71),J=a.n(V),q="/kyc_ocr/model/model.json",$="https://codesque16.github.io/kyc_ocr/model/model_info.txt",Q=600,X=5,Z="web-model",ee=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){var o;return Object(n.a)(this,a),(o=t.call(this,e)).initWebcam=Object(E.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.b.webcam(o.refs.webcam,{resizeWidth:Q,resizeHeight:Q,facingMode:"environment"});case 3:o.webcam=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),o.refs.noWebcam.style.display="block";case 9:case"end":return e.stop()}},e,null,[[0,6]])})),o.startWebcam=Object(E.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.webcam&&o.webcam.start();case 1:case"end":return e.stop()}},e)})),o.stopWebcam=Object(E.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.webcam&&o.webcam.stop();case 1:case"end":return e.stop()}},e)})),o.getModelInfo=Object(E.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat($),{method:"GET"}).then(function(){var e=Object(E.a)(y.a.mark(function e(t){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text().then(function(e){console.log(e),o.modelLastUpdated=e}).catch(function(e){console.log("Unable to get parse model info.")});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log("Unable to get model info")});case 2:case"end":return e.stop()}},e)})),o.updateModel=Object(E.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Updating the model: "+Z),o.setState({isDownloadingModel:!0}),e.next=4,T.c(q);case 4:return o.model=e.sent,e.next=7,o.model.save("indexeddb://"+Z);case 7:o.setState({isDownloadingModel:!1,modelUpdateAvailable:!1,showModelUpdateAlert:!1,showModelUpdateSuccess:!0});case 8:case"end":return e.stop()}},e)})),o.classifyLocalImage=Object(E.a)(y.a.mark(function e(){var t,a,n,r,s,i,c,l,d,u,p;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.setState({isClassifying:!0}),t=o.refs.cropper.getCroppedCanvas(),console.log(t),console.log(T.a.fromPixels(t)),a=T.g(function(){return T.a.fromPixels(t).toFloat()}),console.log(t.toDataURL()),e.next=8,new Uint8ClampedArray(a.array());case 8:return n=e.sent,console.log(n),r=t.toDataURL(),s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imagebuf:r,height:a.shape[0],width:a.shape[1],channels:a.shape[2]})},console.log(s),e.next=15,H(r,o.model);case 15:return i=e.sent,console.log(i),e.next=19,o.getTopKClasses(i,X);case 19:c=e.sent,o.setState({predictions:c,isClassifying:!1,photoSettingsOpen:!o.state.photoSettingsOpen}),l=o.refs.canvas.getContext("2d"),d=Q/t.width,u=Q/t.height,p=Math.min(d,u),l.clearRect(0,0,Q,Q),l.drawImage(t,0,0,t.width*p,t.height*p),a.dispose();case 28:case"end":return e.stop()}},e)})),o.classifyWebcamImage=Object(E.a)(y.a.mark(function e(){var t,a,n,r,s;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.setState({isClassifying:!0}),e.next=3,o.webcam.capture();case 3:return t=e.sent,e.t0=console,e.next=7,J()(t);case 7:return e.t1=e.sent,e.t0.log.call(e.t0,e.t1),e.next=11,J()(t);case 11:return a=e.sent,e.next=14,H(a,o.model);case 14:return n=e.sent,e.next=17,o.getTopKClasses(n,X);case 17:return r=e.sent,o.setState({predictions:r,isClassifying:!1,photoSettingsOpen:!o.state.photoSettingsOpen}),s=T.g(function(){return t.toFloat().div(255)}),e.next=22,T.a.toPixels(s,o.refs.canvas);case 22:t.dispose(),s.dispose();case 24:case"end":return e.stop()}},e)})),o.processImage=function(){var e=Object(E.a)(y.a.mark(function e(t){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t.expandDims(0).toFloat()),e.abrupt("return",T.g(function(){return t.expandDims(0).toFloat().div(127).sub(1)}));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),o.getTopKClasses=function(){var e=Object(E.a)(y.a.mark(function e(t,a){var n,o,r,s,i,c,l;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],o=0;o<t.length;o++)n.push({value:t[o],index:o});for(n.sort(function(e,t){return t.value-e.value}),r=new Float32Array(a),s=new Int32Array(a),i=0;i<a;i++)r[i]=n[i].value,s[i]=n[i].index;for(c=[],l=0;l<s.length;l++)c.push({className:D[s[l]],probability:(100*r[l]).toFixed(2)});return e.abrupt("return",c);case 9:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),o.handlePanelClick=function(e){o.setState({photoSettingsOpen:!o.state.photoSettingsOpen})},o.handleFileChange=function(e){e.target.files&&e.target.files.length>0&&o.setState({file:URL.createObjectURL(e.target.files[0]),filename:e.target.files[0].name})},o.handleTabSelect=function(e){switch(e){case"camera":o.startWebcam();break;case"localfile":o.setState({filename:null,file:null}),o.stopWebcam()}},o.webcam=null,o.model=null,o.modelLastUpdated=null,o.state={modelLoaded:!1,filename:"",isModelLoading:!1,isClassifying:!1,predictions:[],photoSettingsOpen:!0,modelUpdateAvailable:!1,showModelUpdateAlert:!1,showModelUpdateSuccess:!1,isDownloadingModel:!1},o}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=Object(E.a)(y.a.mark(function e(){var t,a,n;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("indexedDB"in window)){e.next=36;break}return e.prev=1,e.next=4,T.c("indexeddb://"+Z);case 4:return this.model=e.sent,e.prev=5,e.next=8,Object(N.a)("tensorflowjs",1);case 8:return t=e.sent,e.next=11,t.transaction("model_info_store").objectStore("model_info_store").get(Z);case 11:return a=e.sent,n=new Date(a.modelArtifactsInfo.dateSaved),e.next=15,this.getModelInfo();case 15:console.log(this.modelLastUpdated),!this.modelLastUpdated||n>=new Date(this.modelLastUpdated).getTime()?console.log("Using saved model"):this.setState({modelUpdateAvailable:!0,showModelUpdateAlert:!0}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(5),console.warn(e.t0),console.warn("Could not retrieve when model was saved.");case 23:e.next=34;break;case 25:return e.prev=25,e.t1=e.catch(1),console.log("Not found in IndexedDB. Loading and saving..."),console.log(e.t1),e.next=31,T.c(q);case 31:return this.model=e.sent,e.next=34,this.model.save("indexeddb://"+Z);case 34:e.next=40;break;case 36:return console.warn("IndexedDB not supported."),e.next=39,T.c(q);case 39:this.model=e.sent;case 40:this.setState({modelLoaded:!0}),this.initWebcam();case 42:case"end":return e.stop()}},e,this,[[1,25],[5,19]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(E.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.webcam&&this.webcam.stop();try{this.model.dispose()}catch(t){}case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:"Classify container"},!this.state.modelLoaded&&c.a.createElement(i.Fragment,null,c.a.createElement(x.a,{animation:"border",role:"status"},c.a.createElement("span",{className:"sr-only"},"Loading..."))," ",c.a.createElement("span",{className:"loading-model-text"},"Loading Model")),this.state.modelLoaded&&c.a.createElement(i.Fragment,null,c.a.createElement(O.a,{onClick:this.handlePanelClick,className:"classify-panel-header","aria-controls":"photo-selection-pane","aria-expanded":this.state.photoSettingsOpen},"Take or Select a Photo to Classify",c.a.createElement("span",{className:"panel-arrow"},this.state.photoSettingsOpen?c.a.createElement(U.b,null):c.a.createElement(U.c,null))),c.a.createElement(C.a,{in:this.state.photoSettingsOpen},c.a.createElement("div",{id:"photo-selection-pane"},this.state.modelUpdateAvailable&&this.state.showModelUpdateAlert&&c.a.createElement(m.a,null,c.a.createElement(v.a,{variant:"info",show:this.state.modelUpdateAvailable&&this.state.showModelUpdateAlert,onClose:function(){return e.setState({showModelUpdateAlert:!1})},dismissible:!0},"An update for the ",c.a.createElement("strong",null,this.state.modelType)," model is available.",c.a.createElement("div",{className:"d-flex justify-content-center pt-1"},!this.state.isDownloadingModel&&c.a.createElement(O.a,{onClick:this.updateModel,variant:"outline-info"},"Update"),this.state.isDownloadingModel&&c.a.createElement("div",null,c.a.createElement(x.a,{animation:"border",role:"status",size:"sm"},c.a.createElement("span",{className:"sr-only"},"Downloading..."))," ",c.a.createElement("strong",null,"Downloading..."))))),this.state.showModelUpdateSuccess&&c.a.createElement(m.a,null,c.a.createElement(v.a,{variant:"success",onClose:function(){return e.setState({showModelUpdateSuccess:!1})},dismissible:!0},"The ",c.a.createElement("strong",null,this.state.modelType)," model has been updated!")),c.a.createElement(k.a,{defaultActiveKey:"camera",id:"input-options",onSelect:this.handleTabSelect,className:"justify-content-center"},c.a.createElement(A.a,{eventKey:"camera",title:"Take Photo"},c.a.createElement("div",{id:"no-webcam",ref:"noWebcam"},c.a.createElement("span",{className:"camera-icon"},c.a.createElement(U.a,null)),"No camera found. ",c.a.createElement("br",null),"Please use a device with a camera, or upload an image instead."),c.a.createElement("div",{className:"webcam-box-outer"},c.a.createElement("div",{className:"webcam-box-inner"},c.a.createElement("video",{ref:"webcam",autoPlay:!0,playsInline:!0,muted:!0,id:"webcam",width:"600",height:"600"}))),c.a.createElement("div",{className:"button-container"},c.a.createElement(_,{variant:"primary",size:"lg",onClick:this.classifyWebcamImage,isLoading:this.state.isClassifying,text:"Classify",loadingText:"Classifying..."}))),c.a.createElement(A.a,{eventKey:"localfile",title:"Select Local File"},c.a.createElement(j.a.Group,{controlId:"file"},c.a.createElement(j.a.Label,null,"Select Image File"),c.a.createElement("br",null),c.a.createElement(j.a.Label,{className:"imagelabel"},this.state.filename?this.state.filename:"Browse..."),c.a.createElement(j.a.Control,{onChange:this.handleFileChange,type:"file",accept:"image/*",className:"imagefile"})),this.state.file&&c.a.createElement(i.Fragment,null,c.a.createElement("div",{id:"local-image"},c.a.createElement(L.a,{ref:"cropper",src:this.state.file,style:{height:"100%",width:"100%"},guides:!0,viewMode:2})),c.a.createElement("div",{className:"button-container"},c.a.createElement(_,{variant:"primary",size:"lg",disabled:!this.state.filename,onClick:this.classifyLocalImage,isLoading:this.state.isClassifying,text:"Classify",loadingText:"Classifying..."}))))))),this.state.predictions.length>0&&c.a.createElement("div",{className:"classification-results"},c.a.createElement("h3",null,"Predictions"),c.a.createElement("canvas",{ref:"canvas",width:Q,height:Q}),c.a.createElement("br",null),c.a.createElement(S.a,null,this.state.predictions.map(function(e){return c.a.createElement(S.a.Item,{key:e.className},c.a.createElement("strong",null,e.className)," ",e.probability,"%")})))))}}]),a}(i.Component),te=function(e){var t=e.childProps;return c.a.createElement(p.c,null,c.a.createElement(p.a,{path:"/kyc_ocr/classify",exact:!0,component:ee,props:t}),c.a.createElement(p.a,{path:"/kyc_ocr/about",exact:!0,component:g,props:t}))},ae=(a(185),a(100)),ne=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){var o;Object(n.a)(this,a),(o=t.call(this,e)).dismissUpdateAlert=function(e){o.setState({showUpdateAlert:!1})};return o.state={showUpdateAlert:!0,reloadMsg:"\n      New content is available.<br />\n      Please <a href='javascript:location.reload();'>reload</a>.<br />\n      <small>If reloading doesn't work, close all tabs/windows of this web application,\n      and then reopen the application.</small>\n    "},o}return Object(o.a)(a,[{key:"componentDidMount",value:function(){Object(ae.a)({onLoaded:function(){console.log(window.cv.getBuildInformation()),console.log("open cv loaded")},onFailed:function(){return console.log("open cv failed to load")},version:"4.5.1"})}},{key:"render",value:function(){return c.a.createElement("div",{className:"App"},c.a.createElement(m.a,null,c.a.createElement(h.a,{collapseOnSelect:!0,className:"app-nav-bar",variant:"dark",expand:"lg"},c.a.createElement(h.a.Brand,{href:"/kyc_ocr"},"KYC"),c.a.createElement(h.a.Toggle,{"aria-controls":"basic-navbar-nav"}),c.a.createElement(h.a.Collapse,{id:"basic-navbar-nav"},c.a.createElement(f.a,{className:""},c.a.createElement(u.b,{className:"nav-link",to:"/kyc_ocr/classify"},"Classify"),c.a.createElement(u.b,{className:"nav-link",to:"/kyc_ocr/about"},"About")))),this.props.updateAvailable&&this.state.showUpdateAlert&&c.a.createElement("div",{style:{paddingTop:"10px"}},c.a.createElement(w,{title:"",variant:"info",message:this.state.reloadMsg,show:this.props.updateAvailable&&this.state.showUpdateAlert,onClose:this.dismissUpdateAlert}))),c.a.createElement(m.a,null,c.a.createElement(te,null)))}}]),a}(i.Component),oe=Object(p.f)(ne),re=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function se(e){if("serviceWorker"in navigator){if(new URL("/kyc_ocr",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/kyc_ocr","/service-worker.js");re?(!function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ie(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):ie(t,e)})}}function ie(e,t){navigator.serviceWorker.register(e).then(function(e){function a(a){console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA2-PWA."),t&&t.onUpdate&&t.onUpdate(e,a)}e.waiting&&e.active&&a(e.waiting),e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?a(n):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var ce=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(){var e;Object(n.a)(this,a);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={contentCached:!1,updateAvailable:!1},e.handleUpdate=function(t){var a=t.waiting;a&&a.postMessage({type:"SKIP_WAITING"}),e.setState({updateAvailable:!0})},e}return Object(o.a)(a,[{key:"componentDidMount",value:function(){se({onUpdate:this.handleUpdate})}},{key:"render",value:function(){return c.a.createElement(u.a,null,c.a.createElement(oe,{updateAvailable:this.state.updateAvailable}))}}]),a}(i.Component);d.a.render(c.a.createElement(ce,null),document.getElementById("root"))}},[[104,1,2]]]);
//# sourceMappingURL=main.1276fd6b.chunk.js.map